<!DOCTYPE html>
<html>

<script type="text/javascript"
	src="../bower_components/angular/angular.min.js"></script>
<script type="text/javascript"
	src="../bower_components/angularjs-socialshare/dist/angular-socialshare.min.js"></script>
<script type="text/javascript" src="../bower_components/d3/d3.min.js"></script>
<script src="../bower_components/ngmap/build/scripts/ng-map.min.js"></script>
<script
	src="http://maps.google.com/maps/api/js?key=AIzaSyD-lGcTPWzqMmRNHdpJ7XxlB5FyYmoDnw8"></script>

<head>
<meta charset="ISO-8859-1">


<link rel="stylesheet" type="text/css"
	href="CountriesOfTheWorldStyle.css">
<link rel="stylesheet" type="text/css" href="socialMedia.css">
<link rel="stylesheet" type="text/css" href="sortingArrows.css">
<link rel="stylesheet" type="text/css" href="listView.css">
<link rel="stylesheet" type="text/css" href="detailView.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<title>Countries of the world</title>
</head>

<body data-ng-app="myApp" data-ng-controller="myCtrl">

	<header>
		<hr>
		<h1>Countries of the world</h1>
		<hr>
	</header>

	<nav data-ng-show="!showListView">
		<button class="left-arrow" data-ng-click="showList()">back to
			overview</button>
		<h2>{{countrySelected.name}}</h2>
	</nav>

	<section data-ng-show="showListView">
		<p>
			Search for Name: <input type="search" data-ng-model="searchString">
			<button type="reset" data-ng-click="reset()">x</button>
		</p>
		<table>
			<thead>
				<tr>
					<th data-ng-click="orderByContent('area')"></th>
					<th class="headerSort" data-ng-click="orderByContent('name')">Name
						<span class="arrow-up"></span> <span class="arrow-down"></span>
					</th>
					<th class="headerSort" data-ng-click="orderByContent('population')">Population
						<span class="arrow-up"></span> <span class="arrow-down"></span>
					</th>
				</tr>
			</thead>

			<tr
				data-ng-repeat="country in data | orderBy:contentToOrder:isSecond | filter:{'name':searchString}"
				data-ng-click="showDetails(country)">
				<td><img id="{{toId(country.name)}}">{{printFlag(toId(country.name),
					country.flag, 40, 60)}}</td>

				<td>{{ country.name }} {{country.area}}</td>
				<td>{{ country.population.toLocaleString('en-US')}}</td>
			</tr>
		</table>

	</section>

	<section style="overflow: hidden;" data-ng-show="!showListView">
		<section class="left">
			<table>
				<tr data-ng-repeat="(key, data) in countrySelected">
					<td>{{key}}</td>
					<td>{{data}}</td>
				</tr>
			</table>

			<p data-ng-binding="curr">
		</section>

		<aside data-ng-show="!showListView">
			<img id="{{toId(countrySelected.name)+'Details'}}">{{printFlag(toId(countrySelected.name)+'Details',countrySelected.flag,
			100, 150)}}
			<ng-map id="map" center="{{countrySelected.name}}"
				zoom="{{calculateZoomByArea(countrySelected.area)}}"></ng-map>
		</aside>

	</section>

	<section data-ng-show="!showListView">
		<a data-socialshare="" data-socialshare-provider="twitter"
			data-socialshare-text="Look at this Country:"
			data-socialshare-url="{{currentLocation}}"> <i
			class="fa fa-twitter"></i>
		</a> <a data-socialshare="" data-socialshare-provider="facebook"
			data-socialshare-url="http://www.tresmo.de"> <!-- doesn't work with lokal path -->
			<i class="fa fa-facebook"></i>
		</a> <a data-socialshare="" data-socialshare-provider="google"
			data-socialshare-url="{{currentLocation}}"> <i
			class="fa fa-google-plus"></i>
		</a>
		<p>Noticed any mistakes? Please contact us:</p>
		<form>
			Name: <input type="text"> <br> E-Mail: <input
				type="email"> <br>
			<textarea rows="10" cols="50">Enter your message here.</textarea>
			<br>
			<button type="submit">send</button>
			<!--  button>send</button-->
		</form>
	</section>


	<footer>
		<hr></hr>
		<p>Posted by: Jessica Ertel</p>
		<!--  p>
			Contact information: <a href="mailto:someone@example.com">
				someone@example.com</a>.
		</p>-->
		<p>
			Content from: <a href="https://restcountries.eu">
				restcountries.eu</a>.
		</p>
		<hr></hr>
	</footer>
	<script>
		var app = angular.module('myApp', ['720kb.socialshare','ngMap']);
		var countryClickCount = 0;
		var populationClickCount = 0;
		 
		
		app.controller('myCtrl', function($scope, $http, $location, $anchorScroll, $timeout, NgMap) {
			$scope.showListView = "true";
			$scope.isSecond = false;
			
			//Get map to load when opend
			NgMap.getMap().then((map) => {
				   $timeout(() => {google.maps.event.trigger(map, 'resize')}, 1000)
				 });
			
			$scope.calculateZoomByArea = function(area){
			var zoom = 13;
				if(area > 6){
					zoom--;
				} if (area > 60){
					zoom--;
				}if (area > 450){
					zoom--;
				}if (area > 15000){
					zoom--;
				}if (area > 35000){
					zoom--;
				}if (area > 65000){
					zoom--;
				}if (area > 200000){
					zoom--;
				}if (area > 500000){
					zoom--;
				}if (area > 1000000){
					zoom--;
				} if (area > 9000000){
					zoom--;
				}
				console.log(zoom);
				return zoom;
				
			}
			
			$http.get("https://restcountries.eu/rest/v2/all").then(
					function(response) {
						$scope.data = response.data;
					});
			$scope.orderByContent = function(x) {
				if (x !== 'population') {
					countryClickCount += 1;
					populationClickCount = 0;
				} else {
					populationClickCount += 1;
					countryClickCount = 0;
				}
				
				if((countryClickCount > 0 && countryClickCount % 2 == 0) || (populationClickCount > 0 && populationClickCount % 2 == 0)){
					$scope.isSecond = true;
				}else {
					$scope.isSecond = false;
				}
				
				$scope.contentToOrder = x;

			};
			$scope.showDetails = function(x) {
				$scope.showListView = !$scope.showListView;
				$scope.currentLocation = $location.absUrl();
				$location.hash(null);
				$anchorScroll();
				$scope.countrySelected = (({ name,flag,region,capital,population,currencies,timezones,area}) => ({ name,flag,region,capital,population,currencies,timezones,area }))(x);
			};
			
			$scope.showList = function() {
				$scope.showListView = !$scope.showListView;
				$location.hash($scope.toId($scope.countrySelected.name));
				$anchorScroll();

			};
			
			$scope.reset = function() {
		        $scope.searchString = "";
		    };
		    
		    $scope.toId =  function(text){
		    	if(text !== undefined){
		    		return text.replace(/[^a-zA-Z ]|\s+/g, "");
		    	}
		    }
		    
		    $scope.printFlag = function(id,url,height,widht){    	
		    	d3.select("#"+id)
				.attr("src",url)
				.attr("width", widht)
				.attr("height", height)
		    
		    }
		    
		    	
			// $scope.map = { center: { latitude: 45, longitude: -73 }, zoom: 8 };
			//in bower.json
		// "jquery": "*",
		// "bootstrap" : "*",
		// "angular-google-maps" : "*",
		// "platform": "*",
		// "benchmark": "*",
		// "lodash" : "*",
		// "angular-socialshare": "*"
		});	
		
	</script>
</body>
</html>